<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex AI - Your Personal Code Mentor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&family=Source+Sans+Pro:wght@400;600&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* New Theme: "Deep Space" */
            --primary: #eb5a5a;
            --primary-light: #66d9ff;
            --bg-main: #0a192f;
            --bg-sidebar: #031122;
            --bg-chat-input: #12213a;
            --bg-code: #011627;
            --text-main: #ccd6f6;
            --text-secondary: #8892b0;
            --border-color: #233554;
            --user-bubble-bg: #112240;
            --ai-bubble-bg: #172a45;
            --sidebar-width: 240px;
            --transition: all 0.3s ease-in-out;
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: 'Source Sans Pro', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            height: 100%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            padding: 25px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 0 25px 25px;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }
        .logo-icon {
            color: var(--primary);
            font-size: 2rem;
        }
        .logo-text {
            font-family: 'Roboto Slab', serif;
            font-size: 1.6rem;
            color: var(--text-main);
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 13px 25px;
            margin: 0 15px 5px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            font-weight: 600;
        }
        .menu-item:hover, .menu-item.active {
            background-color: var(--user-bubble-bg);
            color: var(--primary);
        }
        .menu-item i { width: 20px; text-align: center; }

        .sidebar-footer {
            margin-top: auto;
            padding: 20px 25px 0;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-align: center;
        }

        /* Main Content - Chat Interface */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-main);
        }

        #chat-history {
            flex-grow: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        #chat-history::-webkit-scrollbar { width: 8px; }
        #chat-history::-webkit-scrollbar-track { background: transparent; }
        #chat-history::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 4px; }

        .chat-message {
            display: flex;
            gap: 15px;
            max-width: 80%;
            line-height: 1.7;
        }
        .message-bubble {
            padding: 15px 20px;
            border-radius: 12px;
            word-wrap: break-word;
        }
        .message-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* User Message */
        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .user-message .message-icon {
            background-color: var(--user-bubble-bg);
            color: var(--text-main);
        }
        .user-message .message-bubble {
            background-color: var(--primary);
            color: var(--bg-sidebar);
            border-bottom-right-radius: 0;
            font-weight: 600;
        }

        /* AI Message */
        .ai-message {
            align-self: flex-start;
        }
        .ai-message .message-icon {
            background-color: var(--ai-bubble-bg);
            color: var(--primary);
        }
        .ai-message .message-bubble {
            background-color: var(--ai-bubble-bg);
            border-bottom-left-radius: 0;
        }
        
        /* Code Blocks inside AI message */
        .ai-message pre {
            background-color: var(--bg-code);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
            overflow-x: auto;
        }
        .ai-message code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            color: var(--text-main);
        }
        .ai-message p > code {
            background-color: var(--bg-code);
            padding: 2px 5px;
            border-radius: 4px;
            color: var(--primary-light);
        }
        .copy-code-btn {
            position: absolute;
            top: 10px; right: 10px;
            background: var(--border-color);
            color: var(--text-secondary);
            border: none;
            padding: 5px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0.5;
            transition: var(--transition);
        }
        .ai-message pre:hover .copy-code-btn { opacity: 1; }
        .copy-code-btn:hover { background: var(--primary); color: var(--bg-main); }
        .copy-code-btn .fa-check { color: #28a745; }


        /* AI Typing Indicator */
        .typing-indicator {
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .typing-bubble { display: flex; gap: 5px; padding: 20px; background-color: var(--ai-bubble-bg); border-radius: 12px; }
        .typing-bubble .dot {
            width: 8px; height: 8px;
            background-color: var(--text-secondary);
            border-radius: 50%;
            animation: typing-pulse 1.4s infinite ease-in-out both;
        }
        .typing-bubble .dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-bubble .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-pulse {
            0%, 70%, 100% { transform: scale(0); }
            35% { transform: scale(1); }
        }
        
        /* Chat Input Form */
        .chat-input-form {
            padding: 20px 30px;
            border-top: 1px solid var(--border-color);
            background-color: var(--bg-chat-input);
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        textarea#questionInput {
            flex-grow: 1;
            background-color: var(--user-bubble-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 15px;
            color: var(--text-main);
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 1rem;
            resize: none;
            max-height: 150px;
            transition: var(--transition);
        }
        textarea#questionInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 170, 255, 0.3);
        }

        button#askButton {
            background-color: var(--primary);
            border: none;
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 8px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }
        button#askButton:hover:not(:disabled) {
            background-color: var(--primary-light);
            transform: scale(1.05);
        }
        button#askButton:disabled {
            background-color: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .header { text-align: center; }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-brain logo-icon"></i>
            <span class="logo-text">DSA AI</span>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item active"><i class="fas fa-comments"></i><span>Chat</span></div>
            <div class="menu-item"><i class="fas fa-history"></i><span>History</span></div>
            <div class="menu-item"><i class="fas fa-cog"></i><span>Settings</span></div>
        </div>
        <div class="sidebar-footer">
            <p>v2.0 - Conversational</p>
        </div>
    </div>
    
    <div class="main-content">
        <div class="header">
            DSA-Instructor
        </div>
        
        <div id="chat-history">
            <!-- Chat messages will be dynamically added here -->
            <div class="chat-message ai-message">
                <div class="message-icon"><i class="fas fa-robot"></i></div>
                <div class="message-bubble">
                    <p>Welcome to <strong>DSA AI</strong> ! I'm your personal instructor. Ask me any programming question.</p>
                   
                </div>
            </div>
        </div>
        
        <form class="chat-input-form" id="chat-form">
            <textarea id="questionInput" placeholder="Ask your coding question here..." rows="1"></textarea>
            <button id="askButton" type="submit" title="Send Message">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>

    <script>
        const chatForm = document.getElementById('chat-form');
        const questionInput = document.getElementById('questionInput');
        const askButton = document.getElementById('askButton');
        const chatHistory = document.getElementById('chat-history');

        // ========================================================================
        // !! CRITICAL !!
        // Replace "YOUR_GEMINI_API_KEY" with your actual Google AI Studio API key.
        // This key should be kept secret and not be exposed in public code.
        // ========================================================================
        const GEMINI_API_KEY = "AIzaSyC2gUY-Hm1lx39_ULzKNOAWlzqvg-mvL6o";
        const MODEL_NAME = "gemini-1.5-flash-latest";

        const systemPrompt = `You are a world-class Coding Instructor AI named Codex. Your sole purpose is to 
        answer Data Structure and Algoriths - related questions with clarity, depth, and helpful examples. 
        You will only reply to the problem related to Data structure and Algorithms.
        You will not reply to any other question. If the user asks any other question, then you will reply him 
        rudely like a irritated lazy person. 
        If user ask any question related to Data structure and Algorithm, then you will reply him in a very 
        polite way. Other wise you will reply him rudely.`;
        
        const formatResponse = (text) => {
            let formattedText = text
                .replace(/```(\w*)\n([\s\S]*?)```/g, (match, lang, code) => {
                    const language = lang || 'plaintext';
                    // Sanitize HTML from code to prevent injection
                    const sanitizedCode = code.replace(/</g, "<").replace(/>/g, ">");
                    return `<pre><code class="language-${language}">${sanitizedCode.trim()}</code></pre>`;
                })
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            return formattedText.split('\n').map(p => p.trim() ? `<p>${p}</p>` : '').join('');
        };
        
        const addMessageToHistory = (sender, content) => {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;

            const iconClass = sender === 'user' ? 'fa-user' : 'fa-robot';
            const bubbleContent = sender === 'user' ? `<div class="message-bubble">${content}</div>` : `<div class="message-bubble">${formatResponse(content)}</div>`;

            messageDiv.innerHTML = `
                <div class="message-icon"><i class="fas ${iconClass}"></i></div>
                ${bubbleContent}
            `;
            
            chatHistory.appendChild(messageDiv);
            
            // Add copy buttons to new code blocks
            if (sender === 'ai') {
                const codeBlocks = messageDiv.querySelectorAll('pre');
                codeBlocks.forEach(addCopyButton);
            }
            
            chatHistory.scrollTop = chatHistory.scrollHeight;
        };
        
        const addTypingIndicator = () => {
            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.className = 'typing-indicator';
            indicatorDiv.innerHTML = `
                <div class="message-icon"><i class="fas fa-robot"></i></div>
                <div class="typing-bubble">
                    <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                </div>
            `;
            chatHistory.appendChild(indicatorDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        };

        const removeTypingIndicator = () => {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        };

        const addCopyButton = (preElement) => {
            const button = document.createElement('button');
            button.className = 'copy-code-btn';
            button.innerHTML = '<i class="fas fa-copy"></i> Copy';
            
            button.addEventListener('click', () => {
                const code = preElement.querySelector('code').innerText;
                navigator.clipboard.writeText(code).then(() => {
                    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i> Copy';
                    }, 2000);
                });
            });
            
            preElement.appendChild(button);
        };
        
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = questionInput.value.trim();
            if (!question) return;

            addMessageToHistory('user', question);
            questionInput.value = '';
            questionInput.style.height = 'auto'; // Reset height
            askButton.disabled = true;
            
            addTypingIndicator();

            if (GEMINI_API_KEY === "YOUR_GEMINI_API_KEY") {
                removeTypingIndicator();
                addMessageToHistory('ai', "<strong>Configuration Error:</strong> The API key is missing. Please ask the developer to configure the application correctly.");
                askButton.disabled = false;
                return;
            }

            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${GEMINI_API_KEY}`;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: question }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    }),
                });

                const data = await response.json();
                removeTypingIndicator();

                if (!response.ok || data.error) {
                    throw new Error(data.error?.message || 'An unknown error occurred.');
                }
                
                if (data.promptFeedback && data.promptFeedback.blockReason) {
                    throw new Error(`Request blocked by API: ${data.promptFeedback.blockReason}.`);
                }
                
                const answerText = data.candidates[0].content.parts[0].text;
                addMessageToHistory('ai', answerText);

            } catch (error) {
                console.error('API Error:', error);
                removeTypingIndicator();
                addMessageToHistory('ai', `Sorry, something went wrong. **Error:** ${error.message}`);
            } finally {
                askButton.disabled = false;
            }
        });

        // Auto-resize textarea
        questionInput.addEventListener('input', () => {
            questionInput.style.height = 'auto';
            questionInput.style.height = (questionInput.scrollHeight) + 'px';
        });
        
    </script>
</body>
</html>